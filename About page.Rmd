---
title: "About Page"
author: "Leena Ambady"
date: "3/7/2020"
output: html_document
---
Url to Repository: https://github.com/lambady/Final-Project-2-25-20.git 

For my final project, I want to look at rates of organ donation registration in New York. More specifically, I want to see whether organ procurement organizations or demographic factors have an affect on rates of registration. Organ procurement organizations are supposed to encourage registration and donation and education the counties that they serve. 

This week, I was able to make progress on getting and cleaning some of the demographic data I'm interested in using. I got data from the 2015 American Communities Survey. I was able to get county level racial/ethnic data for New York. I then joined this data with an existing dataset I had that gave organ donation registration enrollments for each county in New York. This data was collected on a monthly basis from the years 2008-2015. Obviously, there are quite a lot of observations then. Something I need to figure out is how to reconcile this registration data was collected very frequently with he demographic data that was collected once every few years. For this week, I just focused on joining the data for the year 2015, since I had ACS data for that. 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
dir.create("raw-data")
library(readr)
library(tidyverse)
library(janitor)
library(dplyr)
library(readxl)
library(tidycensus)
library(stringr)
census_api_key("41e31e7dc9f4be0cac86dd847ae1e2e19837090b")
```

```{r Reading in data}
# This dataset contains the number of registry enrollments in each county of New
# York for the years 2008-2015

new_york <- read.csv("raw-data/Donate_Life_Organ_and_Tissue_Donor_Registry_Enrollment_by_County__Beginning_September_2008.csv") %>%
  clean_names()


# This data set contains information about the address and contact of each organ
# procurement agency in NY. Not sure if I will use this dataset but it's nice to
# have for now.

hrsa <- read.csv("raw-data/ORG_OTC_FCT_DET.csv") %>%
  clean_names

# This dataset contains informatinon about which organ procurement organization
# serves each county in NY. 

OPO <- read.csv("raw-data/Organ_Procurement_Organizations__Eye_Banks_and_Tissue_Banks_Information.csv")


```

```{r Cleaning New York Dataset}
new_york_cleaned <- rename(new_york, 
                           "2012 Census Population" = x2012_census_population,
                           "% Eligible Population Enrolled" = x_eligible_population_enrolled, 
                           "Population 18+ Estimate" = population_18_estimate, 
                           "Organ Procurement Organization" = opo, 
                           "Year" = year, "Month" = month, 
                           "County" = county, 
                           "Registry Enrollments" = registry_enrollments)
```

```{r Cleaning OPO and HRSA Datasets}
hrsa_cleaned <- hrsa %>%
  filter(organ_procurement_organization_state_abbreviation == "NY")

OPO_cleaned <- OPO %>%
  filter(Type == "Organ Procurement Organizations")
  
```

```{r Getting ACS Information that is of interest, include = FALSE}
load_variables(2015, "acs5")

# This code gives me census data from 2015 about the differe ethnic/racial
# demographics in all the different counties of New York. I hope to join this
# with the county data that I have collected on rates of organ donor
# registration in each county of New York.

racevars <- c(White = "B02001_002", 
              Black = "B02001_003", 
              Asian = "B02001_005",
              Hispanic = "B03003_003",
              Puerto_Rican = "B03001_005",
              Dominican = "B03001_007")

ny_county_data <- get_acs(geography = "county",
                  variables = racevars, 
                  year = 2015,
                  state = "NY",
                  geometry = TRUE,
                  summary_var = "B02001_001")

```

```{r}
# One thing I want to do is link the census data for each county to the data
# about the number of registry enrollments in each county. I can do this by
# joining the new_york_cleaned and ny_county_data datasets. First, I need to
# alter the ny_county_data so that it can be joined. Currently the County names
# in this dataset are formatting like "Allegheny County, New York" whereas in
# the new_york_cleaned they are just "Allegheny." Below, I created a new column
# with just the first word so that I can join the datasets.

ny_county_data$County <- word(ny_county_data$NAME, 1) 
ny_county_data_final <- ny_county_data %>%
  mutate(County = recode(County, New = "New York", "St." = "St Lawrence")) 

# Another thing is that the ny_county_data demographic is just from 2015,
# whereas the registry data was recorded each month from 2008-2015. Right now, I
# will just filter it for 2015, but eventually I will need to figure out what
# dates I want to focus on, and if I want to get more demographic data from
# other ACS years. I am not sure it makes sense to have monthly data, and might
# just focus on different years.

County_enrollment_demographic_data <- new_york_cleaned %>%
  filter(Year == "2015") %>%
  filter(!County == "Out of State") %>%
  filter(!County == "Unknown") %>%
  filter(!County == "TOTAL NYS") %>%
  mutate(County = recode(County, Cattauragus = "Cattaraugus")) %>%
  full_join(ny_county_data_final, by = "County") %>%
  select(-summary_moe) 

# Now I have one dataset with information on the number of enrollment registrations and the demographic data for each county in New York. 
```

```{r}
Simplified_Joined <- County_enrollment_demographic_data %>%
  select(-"Organ Procurement Organization", 
         -"location", -"chart_month", -"GEOID", 
         -"NAME", -"geometry") %>%
  rename("Pop_Enrolled" = "% Eligible Population Enrolled") 
  
  # I made it so only the demographics on white are shown, I could probably do
  # this separately for every race I indicated
  
 White_Plot <- Simplified_Joined %>%
   filter(variable == "White") %>%
  mutate(Prop_White = (estimate/summary_est))


White_Plot %>%
#  filter(Month == "11") %>%
  ggplot(aes(x = Pop_Enrolled, 
             y = fct_reorder(County, Pop_Enrolled), 
             color = Prop_White)) + 
  geom_point(alpha = 0.7) +
  theme(axis.text.y = element_text(size = 5.5)) +
    scale_colour_gradient(low = "yellow", high = "red") + 
  labs(x = "% of Population Registered as an Organ Donor", 
       y = "County",
       title = "New York Organ Donation Registration Rates by County in 2015",
       subtitle = "Registration Rates Measured Monthly",
       color = "Proportion of Population that is White") 

ggsave("MS6/prop_white.png")
  
```

```{r}
Black_Plot <- Simplified_Joined %>%
 filter(variable == "Black") %>%
  mutate(Prop_Black = (estimate/summary_est))


Black_Plot %>%
  ggplot(aes(x = Pop_Enrolled, 
             y = fct_reorder(County, Pop_Enrolled), 
             color = Prop_Black)) + 
  geom_point(alpha = 0.7) +
  theme(axis.text.y = element_text(size = 5.5)) +
  scale_colour_gradient(low = "yellow", high = "red") + 
  labs(x = "% of Population Registered as an Organ Donor", 
       y = "County",
       title = "New York Organ Donation Registration Rates by County in 2015",
       subtitle = "Registration Rates Measured Monthly",
       color = "Proportion of Population that is Black") 

ggsave("MS6/prop_black.png")
```

```{r}
Hispanic_Plot <- Simplified_Joined %>%
 filter(variable == "Hispanic") %>%
  mutate(Prop_Hispanic = (estimate/summary_est))


Hispanic_Plot %>%
  ggplot(aes(x = Pop_Enrolled, 
             y = fct_reorder(County, Pop_Enrolled), 
             color = Prop_Hispanic)) + 
  geom_point(alpha = 0.7) +
  theme(axis.text.y = element_text(size = 5.5)) +
  labs(x = "% of Population Registered as an Organ Donor", 
       y = "County",
       title = "New York Organ Donation Registration Rates by County in 2015",
       subtitle = "Registration Rates Measured Monthly",
       color = "Proportion of Population that is Hispanic") 
```

```{r}
Asian_Plot <- Simplified_Joined %>%
 filter(variable == "Asian") %>%
  mutate(Prop_Asian = (estimate/summary_est))


Asian_Plot %>%
  ggplot(aes(x = Pop_Enrolled, 
             y = fct_reorder(County, Pop_Enrolled), 
             color = Prop_Asian)) + 
  geom_point(alpha = 0.7) +
  theme(axis.text.y = element_text(size = 5.5)) +
  scale_colour_gradient(low = "yellow", high = "red") + 
  labs(x = "% of Population Registered as an Organ Donor", 
       y = "County",
       title = "New York Organ Donation Registration Rates by County in 2015",
       subtitle = "Registration Rates Measured Monthly",
       color = "Proportion of Population that is Asian") 

ggsave("MS6/prop_asian.png")
```

